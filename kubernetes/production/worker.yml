apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: worker
spec:
  template:
    metadata:
      name: worker
      labels:
        app: teachbot
        sub: worker
    spec:
      containers:
        - name: worker
          image: gcr.io/kubernetes-168515/teachbot_worker
          env:
            - name: RAILS_ENV
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: rails_env
            - name: RAILS_LOG_TO_STDOUT
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: rails_log_to_stdout
            - name: SECRET_KEY_BASE
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: secret_key_base
            - name: POSTGRES_DB
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: postgres_db
            - name: POSTGRES_USER
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: postgres_user
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: postgres_password
            - name: DB_HOST
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: db_host
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: redis_url
            - name: ELASTICSEARCH_URL
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: elasticsearch_url
            - name: RECAPTCHA_PUBLIC_KEY
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: recaptcha_public_key
            - name: RECAPTCHA_PRIVATE_KEY
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: recaptcha_private_key
            - name: GOOGLE_API_KEY
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: google_api_key
            - name: FACEBOOK_APP_ID
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: facebook_app_id
            - name: FACEBOOK_APP_SECRET
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: facebook_app_secret
            - name: GITHUB_APP_ID
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: github_app_id
            - name: GITHUB_APP_SECRET
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: github_app_secret
            - name: ADMIN_ACCOUNT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: admin_account_password
            - name: S3_BUCKET
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: s3_bucket
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: aws_access_key_id
            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: aws_secret_access_key
            - name: SENDGRID_USERNAME
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: sendgrid_username
            - name: SENDGRID_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: sendgrid_password
            - name: APP_HOST
              valueFrom:
                secretKeyRef:
                  name: prod-secrets
                  key: app_host